

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Autocorrelaci√≥n espacial &#8212; An√°lisis Geoespacial</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6" />
  <script src="_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=365ca57ee442770a23c6"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '07_ArealData';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="An√°lisis de datos areales: mapas" href="06_ArealData.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="An√°lisis Geoespacial - Home"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="An√°lisis Geoespacial - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    <no title>
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="00_Ambiente.html">Ambiente computacional</a></li>
<li class="toctree-l1"><a class="reference internal" href="01_DatosEspaciales.html">Datos espaciales</a></li>


<li class="toctree-l1"><a class="reference internal" href="02_Mapping.html">El arte de hacer mapas</a></li>
<li class="toctree-l1"><a class="reference internal" href="03_PointPattern.html">Patr√≥n de puntos</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_GLMPoisson.html">Modelos Lineales Generalizados (GLM) para Poisson</a></li>
<li class="toctree-l1"><a class="reference internal" href="05_LGCP.html">Procesos Log-Gaussian Cox</a></li>
<li class="toctree-l1"><a class="reference internal" href="06_ArealData.html">An√°lisis de datos areales: mapas</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Autocorrelaci√≥n espacial</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/edieraristizabal/Libro_AnalisisGeoespacial" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/edieraristizabal/Libro_AnalisisGeoespacial/issues/new?title=Issue%20on%20page%20%2F07_ArealData.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/07_ArealData.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Autocorrelaci√≥n espacial</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#matriz-de-pesos-basada-en-contiguidad">Matriz de pesos basada en contiguidad</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#matriz-de-pesos-basada-en-distancias">Matriz de pesos basada en distancias</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#spatial-lag">Spatial lag</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#autocorrelacion-espacial-global">Autocorrelaci√≥n espacial global</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#caso-binario-conteos-de-union">Caso binario: conteos de uni√≥n</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#grafico-de-moran">Gr√°fico de Moran</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#autocorrelacion-espacial-local">Autocorrelaci√≥n espacial local</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <p style="font-size:11px;"><em><strong>Cr√©ditos</strong>: El contenido de este cuaderno ha sido tomado de varias fuentes, pero especialmente de <a href="http://darribas.org/">Dani Arribas-Bel</a> - University of Liverpool & <a href="http://spatial.ucr.edu/peopleRey.html">Sergio Rey</a> - Center for Geospatial Sciences, University of California, Riverside. El compilador se disculpa por cualquier omisi√≥n involuntaria y estar√≠a encantado de agregar un reconocimiento.</em></p><section class="tex2jax_ignore mathjax_ignore" id="autocorrelacion-espacial">
<h1>Autocorrelaci√≥n espacial<a class="headerlink" href="#autocorrelacion-espacial" title="Permalink to this heading">#</a></h1>
<p>La autocorrelaci√≥n espacial tiene que ver con el grado en que la similitud en los valores entre observaciones en un conjunto de datos est√° relacionada con la similitud en las ubicaciones de dichas observaciones. No es completamente diferente de la correlaci√≥n tradicional entre dos variables, que nos informa sobre c√≥mo cambian los valores en una variable en funci√≥n de los de la otra, y es an√°loga a su contraparte de series temporales, que relaciona el valor de una variable en un momento dado con los de per√≠odos anteriores. La autocorrelaci√≥n espacial relaciona el valor de la variable de inter√©s en una ubicaci√≥n dada con los valores de la misma variable en ubicaciones circundantes.</p>
<p>Una idea clave en este contexto es la de aleatoriedad espacial: una situaci√≥n en la que la ubicaci√≥n de una observaci√≥n no proporciona ninguna informaci√≥n sobre su valor. En otras palabras, una variable es espacialmente aleatoria si se distribuye sin seguir un patr√≥n discernible sobre el espacio. Por lo tanto, la autocorrelaci√≥n espacial puede definirse formalmente como la ‚Äúausencia de aleatoriedad espacial‚Äù, lo que da lugar a dos clases principales de autocorrelaci√≥n, similares al caso tradicional: autocorrelaci√≥n espacial <em>positiva</em>, cuando los valores similares tienden a agruparse en ubicaciones similares; y autocorrelaci√≥n espacial <em>negativa</em>, en casos donde los valores similares tienden a dispersarse y estar m√°s separados entre s√≠.</p>
<p>La herramienta fundamental para evaluar la relaci√≥n espacial entre observaciones corresponde a la matriz espacial de pesos. La matriz de pesos tiene dimensiones de <span class="math notranslate nohighlight">\(N\)</span> by <span class="math notranslate nohighlight">\(N\)</span>, donde <span class="math notranslate nohighlight">\(N\)</span> es el n√∫mero total de observaciones:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
W = \left(\begin{array}{cccc}
0 &amp; w_{12} &amp; \dots &amp; w_{1N} \\
w_{21} &amp; \ddots &amp; w_{ij} &amp; \vdots \\
\vdots &amp; w_{ji} &amp; 0 &amp; \vdots \\
w_{N1} &amp; \dots &amp; \dots &amp; 0 
\end{array} \right)
\end{split}\]</div>
<p>Donde cada celda <span class="math notranslate nohighlight">\(w_{ij}\)</span> corresponde a un valor que representa el grado espacial de contacto o interacci√≥n entre los valores <span class="math notranslate nohighlight">\(i\)</span> y <span class="math notranslate nohighlight">\(j\)</span>. Por convenci√≥n, la diagonal (<span class="math notranslate nohighlight">\(w_{ij}\)</span>) son ceros. El valor <span class="math notranslate nohighlight">\(W\)</span> de <span class="math notranslate nohighlight">\(i\)</span> y <span class="math notranslate nohighlight">\(j\)</span> son vecinas si <span class="math notranslate nohighlight">\(w_{ij}&gt;0\)</span>.</p>
<p>Una matriz de pesos espaciales es la forma en que el espacio geogr√°fico se codifica formalmente en una forma num√©rica para que sea f√°cil de entender para una computadora (o un m√©todo estad√≠stico). Ya hemos visto muchas de las formas conceptuales en las que podemos definir una matriz de pesos espaciales, como la contig√ºidad, basada en la distancia o en bloques.</p>
<section id="matriz-de-pesos-basada-en-contiguidad">
<h2>Matriz de pesos basada en contiguidad<a class="headerlink" href="#matriz-de-pesos-basada-en-contiguidad" title="Permalink to this heading">#</a></h2>
<p>Para este ejemplo, mostraremos c√≥mo construir una matriz de contig√ºidad <strong>Queen</strong>, que considera dos observaciones como vecinas si comparten al menos un punto de su l√≠mite. En otras palabras, para que un par de autoridades locales en el conjunto de datos sean consideradas vecinas bajo este <span class="math notranslate nohighlight">\(W\)</span>, necesitar√°n compartir frontera o, en otras palabras, ‚Äútocarse‚Äù en cierto grado.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">br</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;http://darribas.org/gds19/content/labs/data/brexit.gpkg&#39;</span><span class="p">)</span>
<span class="n">br</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">br</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;http://darribas.org/gds19/content/labs/data/brexit.gpkg&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">br</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;gpd&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">br</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">br_path</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;LAD14CD&#39;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">br</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w_queen</span> <span class="o">=</span> <span class="n">weights</span><span class="o">.</span><span class="n">Queen</span><span class="o">.</span><span class="n">from_dataframe</span><span class="p">(</span><span class="n">br</span><span class="p">,</span> <span class="n">idVariable</span><span class="o">=</span><span class="s2">&quot;LAD14CD&quot;</span><span class="p">)</span>
<span class="n">w_queen</span>
</pre></div>
</div>
</div>
</div>
<p>Con la matriz de pesos de Queen podemos saber cuales son los poligonos vecinos para cualquier observaci√≥n:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w_queen</span><span class="p">[</span><span class="s1">&#39;E06000003&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w_queen</span><span class="o">.</span><span class="n">neighbors</span><span class="p">[</span><span class="s1">&#39;E06000003&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w_queen</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="s1">&#39;E06000007&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Ademas permite conocer la relaci√≥n de vencindad entre dos observaciones espec√≠ficas:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w_queen</span><span class="p">[</span><span class="s1">&#39;E06000003&#39;</span><span class="p">][</span><span class="s1">&#39;E07000164&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Al igual que el n√∫mero de vecinos para cada observaci√≥n:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w_queen</span><span class="o">.</span><span class="n">cardinalities</span><span class="p">[</span><span class="s1">&#39;E06000003&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Para conocer el n√∫mero de vecinos para cada observaci√≥n se puede obtener la siguiente tabla:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">queen_card</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">w_queen</span><span class="o">.</span><span class="n">cardinalities</span><span class="p">)</span>
<span class="n">queen_card</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Para graficar una observaci√≥n y sus vecinos utilizamos el siguiente script:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup figure</span>
<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="c1"># Plot base layer of polygons</span>
<span class="n">br</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="c1"># Select focal polygon</span>
<span class="c1"># NOTE we pass both the area code and the column name</span>
<span class="c1">#      (`geometry`) within brackets!!!</span>
<span class="n">focus</span> <span class="o">=</span> <span class="n">br</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s1">&#39;E06000007&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>
<span class="c1"># Plot focal polygon</span>
<span class="n">focus</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="c1"># Plot neighbors</span>
<span class="n">neis</span> <span class="o">=</span> <span class="n">br</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">w_queen</span><span class="p">[</span><span class="s1">&#39;E06000007&#39;</span><span class="p">],</span> <span class="p">:]</span>
<span class="n">neis</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;lime&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Queen neighbors of `E06000007`&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w_queen</span><span class="o">.</span><span class="n">max_neighbors</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w_queen</span><span class="o">.</span><span class="n">islands</span>
</pre></div>
</div>
</div>
</div>
<p>La celda donde calculamos <span class="math notranslate nohighlight">\(W\)</span> devolvi√≥ una advertencia sobre ‚Äúislas‚Äù. Recuerda que estas son islas no necesariamente en el sentido geogr√°fico (aunque algunas lo ser√°n), sino en el sentido matem√°tico del t√©rmino: autoridades locales que no comparten frontera con ninguna otra y, por lo tanto, no tienen vecinos. Podemos inspeccionar y mapearlas para tener una mejor idea de con qu√© estamos tratando.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">br</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">br</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">w_queen</span><span class="o">.</span><span class="n">islands</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>En este caso, todas las islas son realmente ‚Äúislas‚Äù en el sentido geogr√°fico. Estos casos pueden crear problemas en el an√°lisis y distorsionar los resultados. Hay varias soluciones a esta situaci√≥n, como conectar las islas a otras observaciones a trav√©s de un criterio diferente (por ejemplo, el vecino m√°s cercano), y luego combinar ambas matrices de pesos espaciales. Por conveniencia, las eliminaremos del conjunto de datos porque son una muestra peque√±a y su eliminaci√≥n probablemente no tendr√° un gran impacto en los <a class="reference external" href="http://xn--clculos-hwa.eE">c√°lculos.eE</a> este caso usaremos el comando <code class="docutils literal notranslate"><span class="pre">drop</span></code>, que es muy √∫til en estos casos:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">br</span> <span class="o">=</span> <span class="n">br</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">w_queen</span><span class="o">.</span><span class="n">islands</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Una vez que tengamos el conjunto de autoridades locales que no son islas, necesitamos volver a calcular la matriz de pesos:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the spatial weights matrix</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">weights</span><span class="o">.</span><span class="n">Queen</span><span class="o">.</span><span class="n">from_dataframe</span><span class="p">(</span><span class="n">br</span><span class="p">,</span> <span class="n">idVariable</span><span class="o">=</span><span class="s1">&#39;LAD14CD&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Y, finalmente, vamos a estandarizar por filas para asegurarnos de que cada fila de la matriz sume uno:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Row standardize the matrix</span>
<span class="n">w</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="s1">&#39;R&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Ahora</span><span class="p">,</span> <span class="n">debido</span> <span class="n">a</span> <span class="n">que</span> <span class="n">los</span> <span class="n">hemos</span> <span class="n">estandarizado</span> <span class="n">por</span> <span class="n">filas</span><span class="p">,</span> <span class="n">el</span> <span class="n">peso</span> <span class="n">dado</span> <span class="n">a</span> <span class="n">cada</span> <span class="n">uno</span> <span class="n">de</span> <span class="n">los</span> <span class="n">cuatro</span> <span class="n">vecinos</span> <span class="n">es</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">lo</span> <span class="n">que</span><span class="p">,</span> <span class="n">en</span> <span class="n">total</span><span class="p">,</span> <span class="n">suma</span> <span class="n">uno</span><span class="o">.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w</span><span class="p">[</span><span class="s1">&#39;E08000012&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Pero no solamente existe tipo <strong>Queens</strong>. La designaci√≥n de vecinos se puede identificar con una analog√≠a de ajedrez: casos horizontales/verticales (<strong>Rooks</strong>), casos diagonales (<strong>Bishops</strong>) o en todos los casos (<strong>Queens</strong>) a lo largo de una cuadr√≠cula regular. En pol√≠gonos irregulares, los vecinos tipo torre est√°n conectados a lo largo de los bordes, los vecinos tipo <strong>Bishops</strong> por puntos, y los vecinos tipo <strong>Queens</strong> tanto por puntos como por bordes. As√≠ que en este ejemplo, el vecindario establecido utilizando el caso de las <strong>Queens</strong> contiene ocho (8) vecinos, cuatro (4) vecinos por bordes en el caso de las <strong>Rooks</strong>, y cuatro (4) vecinos por puntos en el caso de los <strong>Bishops</strong>.</p>
<img src="https://i.pinimg.com/564x/ad/d9/78/add978b7eea6a8ec39e45be6beeea529.jpg" style="width: 50%;"/></section>
<section id="matriz-de-pesos-basada-en-distancias">
<h2>Matriz de pesos basada en distancias<a class="headerlink" href="#matriz-de-pesos-basada-en-distancias" title="Permalink to this heading">#</a></h2>
<p>Las matrices de pesos basadas en la distancia asignan los pesos de acuerdo con dicha distancia. Es importante para este tipo de an√°lisis contar con los datos proyectados a un sistema de coordenadas planas y no geogr√°fico, de tal forma que permita medir distancias. Para este caso se debe reproyectar:</p>
<img src="https://i.pinimg.com/564x/ed/a9/6c/eda96cea5c70aab018bf6fe326f4a540.jpg" style="width: 50%;"/><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">imd</span><span class="o">=</span><span class="n">br</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">27700</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Para el caso del m√©todo de vecino mas cercano (KNN) se debe ingresar como argumento el n√∫mero de vecinos a considerar.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">knn5</span> <span class="o">=</span> <span class="n">weights</span><span class="o">.</span><span class="n">KNN</span><span class="o">.</span><span class="n">from_dataframe</span><span class="p">(</span><span class="n">imd</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">knn5</span><span class="p">[</span><span class="s1">&#39;E06000007&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">knn5</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="s1">&#39;E06000007&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">knn5</span><span class="o">.</span><span class="n">neighbors</span><span class="p">[</span><span class="s1">&#39;E06000007&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">knn5_card</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">knn5</span><span class="o">.</span><span class="n">cardinalities</span><span class="p">)</span>
<span class="n">knn5_card</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Otra forma de hacerlo es identificar manualmente el centroide de cada poligono.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cents</span> <span class="o">=</span> <span class="n">imd</span><span class="o">.</span><span class="n">centroid</span>
<span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">pt</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">pt</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">cents</span><span class="p">])</span> <span class="c1"># Extract coordinates into an array</span>
<span class="n">knn5_from_pts</span> <span class="o">=</span> <span class="n">weights</span><span class="o">.</span><span class="n">KNN</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> <span class="c1"># Compute KNN weights</span>
<span class="n">knn5_from_pts</span>
</pre></div>
</div>
</div>
</div>
<p>Para conocer el n√∫mero de vecinos en una distancia dada se utiliza el m√©todo de Bandas, donde a cada observaci√≥n dentro del rango establecido se le asigna un peso igual al inverso de la distancia:</p>
<div class="math notranslate nohighlight">
\[
w_{ij} = \dfrac{1}{d_{ij}}
\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w_dist50kmB</span> <span class="o">=</span> <span class="n">weights</span><span class="o">.</span><span class="n">DistanceBand</span><span class="o">.</span><span class="n">from_dataframe</span><span class="p">(</span><span class="n">imd</span><span class="p">,</span> <span class="mi">50000</span><span class="p">)</span>
<span class="n">w_dist50kmB</span><span class="p">[</span><span class="s1">&#39;E06000007&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w_dist50kmC</span> <span class="o">=</span> <span class="n">weights</span><span class="o">.</span><span class="n">DistanceBand</span><span class="o">.</span><span class="n">from_dataframe</span><span class="p">(</span><span class="n">imd</span><span class="p">,</span> <span class="mi">50000</span><span class="p">,</span> <span class="n">binary</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">w_dist50kmC</span><span class="p">[</span><span class="s1">&#39;E06000007&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>La forma grafica del anterior an√°lisis se puede ejecutar de la siguiente forma:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup figure</span>
<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="c1"># Plot base layer of polygons</span>
<span class="n">imd</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="c1"># Select focal polygon</span>
<span class="c1"># NOTE we pass both the area code and the column name</span>
<span class="c1">#      (`geometry`) within brackets!!!</span>
<span class="n">focus</span> <span class="o">=</span> <span class="n">imd</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s1">&#39;E06000007&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>
<span class="c1"># Plot focal polygon</span>
<span class="n">focus</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="c1"># Plot neighbors</span>
<span class="n">neis</span> <span class="o">=</span> <span class="n">imd</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">w_dist50kmC</span><span class="p">[</span><span class="s1">&#39;E06000007&#39;</span><span class="p">],</span> <span class="p">:]</span>
<span class="n">neis</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;lime&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># Plot 1km buffer</span>
<span class="n">buf</span> <span class="o">=</span> <span class="n">focus</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="mi">50000</span><span class="p">)</span>
<span class="n">buf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="c1"># Plot centroids of neighbor</span>
<span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">pt</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">pt</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">imd</span><span class="o">.</span><span class="n">centroid</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pts</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">pts</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#00d8ea&#39;</span><span class="p">,</span> 
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="c1"># Title</span>
<span class="n">f</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Neighbors within 1km of `E06000007`&quot;</span><span class="p">)</span>
<span class="c1"># Style, zoom and display on screen</span>
<span class="c1">#ax.set_ylim(388000, 393500)</span>
<span class="c1">#ax.set_xlim(336000, 339500)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="spatial-lag">
<h2>Spatial lag<a class="headerlink" href="#spatial-lag" title="Permalink to this heading">#</a></h2>
<p>El <em>spatial lag</em> de una variable es el producto de la matriz de pesos con la variable misma.</p>
<div class="math notranslate nohighlight">
\[
Y_{sl} = W Y
\]</div>
<p>Donde ùëå  es un vector Nx1 con los valores de la variable.</p>
<div class="math notranslate nohighlight">
\[
y_{sl-i} = \displaystyle \sum_j w_{ij} y_j
\]</div>
<p>Una vez que tengamos los datos y la matriz de pesos espaciales listos, podemos comenzar calculando el retraso espacial del porcentaje de votos que se emitieron para salir de la UE. Recuerda que el retraso espacial es el producto de la matriz de pesos espaciales y una variable dada, y que si <span class="math notranslate nohighlight">\(W\)</span> est√° estandarizado por filas, el resultado equivale al valor promedio de la variable en el vecindario de cada observaci√≥n.</p>
<p>Podemos calcular el <em>spatial lag</em> para la variable <code class="docutils literal notranslate"><span class="pre">Pct_Leave</span></code> y almacenarlo directamente en la tabla principal con la siguiente l√≠nea de c√≥digo:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">br</span><span class="p">[</span><span class="s1">&#39;w_Pct_Leave&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">weights</span><span class="o">.</span><span class="n">lag_spatial</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">br</span><span class="p">[</span><span class="s1">&#39;Pct_Leave&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Demos un vistazo r√°pido a la variable resultante, en comparaci√≥n con la original:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">br</span><span class="p">[[</span><span class="s1">&#39;LAD14NM&#39;</span><span class="p">,</span> <span class="s1">&#39;Pct_Leave&#39;</span><span class="p">,</span> <span class="s1">&#39;w_Pct_Leave&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>La forma de interpretar el retraso espacial (<code class="docutils literal notranslate"><span class="pre">w_Pct_Leave</span></code>) para, por ejemplo, la primera observaci√≥n, es la siguiente: Hartlepool, donde el 69,6% del electorado vot√≥ para salir, est√° rodeado por autoridades locales vecinas donde, en promedio, casi el 62% del electorado tambi√©n vot√≥ para salir de la UE. Para fines de ilustraci√≥n, de hecho podemos verificar que esto es correcto consultando la matriz de pesos espaciales para averiguar los vecinos de Hartepool:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w</span><span class="o">.</span><span class="n">neighbors</span><span class="p">[</span><span class="s1">&#39;E06000001&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Estos son los valores de las expectativas te√≥ricas para cada tipo de uni√≥n:57</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">neis</span> <span class="o">=</span> <span class="n">br</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">w</span><span class="o">.</span><span class="n">neighbors</span><span class="p">[</span><span class="s1">&#39;E06000001&#39;</span><span class="p">],</span> <span class="s1">&#39;Pct_Leave&#39;</span><span class="p">]</span>
<span class="n">neis</span>
</pre></div>
</div>
</div>
</div>
<p>Y el valor promedio, que vimos en el retraso espacial como 61.8, se puede calcular de la siguiente manera:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">neis</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Para comparar f√°cilmente diferentes gr√°ficos de dispersi√≥n y detectar observaciones at√≠picas, es pr√°ctica com√∫n estandarizar los valores de la variable antes de calcular su retraso espacial y representarlo. Esto se puede lograr restando el valor promedio y dividiendo el resultado por la desviaci√≥n est√°ndar:</p>
<p><span class="math notranslate nohighlight">\(
z_i = \frac{y - \bar{y}}{\sigma_y}
\)</span></p>
<p>Estandarizar significa restar el valor promedio y dividir por la desviaci√≥n est√°ndar cada observaci√≥n de la columna. Esto se puede hacer f√°cilmente con un poco de √°lgebra b√°sica en Python:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">br</span><span class="p">[</span><span class="s1">&#39;Pct_Leave_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">br</span><span class="p">[</span><span class="s1">&#39;Pct_Leave&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">br</span><span class="p">[</span><span class="s1">&#39;Pct_Leave&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">/</span> <span class="n">br</span><span class="p">[</span><span class="s1">&#39;Pct_Leave&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Finalmente, para poder explorar los patrones espaciales de los valores estandarizados, a veces tambi√©n llamados valores <span class="math notranslate nohighlight">\(z\)</span>, necesitamos crear su retraso espacial:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">br</span><span class="p">[</span><span class="s1">&#39;w_Pct_Leave_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">weights</span><span class="o">.</span><span class="n">lag_spatial</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">br</span><span class="p">[</span><span class="s1">&#39;Pct_Leave_std&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span> <span class="o">=</span> <span class="n">axs</span>
<span class="n">br</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;Pct_Leave&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">scheme</span><span class="o">=</span><span class="s1">&#39;quantiles&#39;</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">% Le</span><span class="s2">ave&quot;</span><span class="p">)</span>
<span class="n">ctx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span><span class="n">crs</span><span class="o">=</span><span class="n">br</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="n">ctx</span><span class="o">.</span><span class="n">providers</span><span class="o">.</span><span class="n">Stamen</span><span class="o">.</span><span class="n">TerrainBackground</span><span class="p">)</span>
<span class="n">br</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;w_Pct_Leave&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">scheme</span><span class="o">=</span><span class="s1">&#39;quantiles&#39;</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">% Le</span><span class="s2">ave - Spatial Lag&quot;</span><span class="p">)</span>
<span class="n">ctx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax2</span><span class="p">,</span><span class="n">crs</span><span class="o">=</span><span class="n">br</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="n">ctx</span><span class="o">.</span><span class="n">providers</span><span class="o">.</span><span class="n">Stamen</span><span class="o">.</span><span class="n">TerrainBackground</span><span class="p">,)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Las marcadas diferencias a la izquierda entre vecinos inmediatos (como en el caso de Liverpool, en el noroeste de Inglaterra) se aten√∫an en el mapa de la derecha.</p>
</section>
<section id="autocorrelacion-espacial-global">
<h2>Autocorrelaci√≥n espacial global<a class="headerlink" href="#autocorrelacion-espacial-global" title="Permalink to this heading">#</a></h2>
<p>El mapa anterior es una buena manera de comenzar a explorar los principales patrones espaciales en los datos. A primera vista, parece mostrar una cantidad considerable de autocorrelaci√≥n espacial positiva: las autoridades locales con altos porcentajes de votos para salir de la UE tienden a estar cerca unas de otras (ver, por ejemplo, la regi√≥n oriental), al igual que aquellas donde una proporci√≥n mucho menor de su poblaci√≥n vot√≥ para salir (con Escocia siendo un buen ejemplo en el norte). Sin embargo, los humanos son muy buenos detectores de patrones. A lo largo de nuestra historia desde que empezamos como especie, la vida ha recompensado las habilidades de reconocimiento de patrones y ha castigado a los individuos que carecen de ellas. Piensa en la ventaja que ten√≠an nuestros ancestros si pod√≠an detectar formas o movimientos particulares mientras cazaban, o en los problemas en los que pod√≠an meterse si no eran capaces de reconocer a ciertos otros en la oscuridad de la noche en la selva. Esta extraordinaria capacidad para detectar tendencias, patrones y asociaciones tambi√©n tiende a crear muchos falsos positivos: casos en los que pensamos que hay un patr√≥n pero, de hecho, lo que estamos viendo es en gran medida aleatorio. Esto se acent√∫a particularmente en el caso de los mapas donde, la forma de las geometr√≠as tambi√©n puede distorsionar significativamente nuestra percepci√≥n. Al observar el mapa anterior, por ejemplo, podemos hacer una suposici√≥n educada sobre la presencia de autocorrelaci√≥n espacial; pero en realidad determinar si lo que estamos viendo podr√≠a haber ocurrido por pura casualidad o no suele ser m√°s f√°cil decirlo que hacerlo.</p>
<p>Ese es exactamente el prop√≥sito de los indicadores de autocorrelaci√≥n espacial global: aprovechar el poder de la estad√≠stica para ayudarnos primero a resumir la distribuci√≥n espacial de los valores presentes en un mapa, y segundo obtener una cuantificaci√≥n formal de la desviaci√≥n de la aleatoriedad. Las estad√≠sticas dise√±adas para medir esta tendencia caracterizan as√≠ un mapa en t√©rminos de su grado de agrupamiento y lo resumen, ya sea de manera visual o num√©rica. Sin embargo, antes de que podamos sumergirnos en las estad√≠sticas, necesitamos entender un bloque de construcci√≥n fundamental: <em>spatial lag</em>. Con ese concepto estamos en posici√≥n de construir una buena comprensi√≥n de la autocorrelaci√≥n espacial global. Entraremos suavemente en ella con el caso binario, cuando las observaciones solo pueden tomar dos valores (potencialmente categ√≥ricos), antes de cubrir los dos del caso continuo: el Gr√°fico de Moran y el √çndice de Moran (Moran‚Äôs I).</p>
<section id="caso-binario-conteos-de-union">
<h3>Caso binario: conteos de uni√≥n<a class="headerlink" href="#caso-binario-conteos-de-union" title="Permalink to this heading">#</a></h3>
<p>El retraso espacial juega un papel importante en la cuantificaci√≥n de la autocorrelaci√≥n espacial. Us√°ndolo, podemos comenzar a relacionar el comportamiento de una variable en una ubicaci√≥n dada con su patr√≥n en el vecindario inmediato. Las medidas de autocorrelaci√≥n espacial global luego usar√°n cada observaci√≥n para construir medidas generales sobre la tendencia general en un conjunto de datos dado.</p>
<p>Nuestra primera incursi√≥n en estas medidas considera un caso simplificado: valores binarios. Esto ocurre cuando la variable en la que estamos interesados solo toma dos valores. En este contexto, estamos interesados en saber si una observaci√≥n dada est√° rodeada por otras dentro de la misma categor√≠a. Por ejemplo, volviendo a nuestro conjunto de datos, queremos evaluar en qu√© medida las autoridades locales que votaron para salir tienden a estar rodeadas por otras que tambi√©n votaron para salir. Para proceder, primero calculemos una variable binaria (Leave) que indique 1 si la autoridad local vot√≥ para salir, y cero en caso contrario:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">br</span><span class="p">[</span><span class="s1">&#39;Leave&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">br</span><span class="p">[</span><span class="s1">&#39;Pct_Leave&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">br</span><span class="p">[[</span><span class="s1">&#39;Pct_Leave&#39;</span><span class="p">,</span> <span class="s1">&#39;Leave&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Lo cual podemos visualizar f√°cilmente:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">br</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s1">&#39;Leave&#39;</span><span class="p">,</span> <span class="n">categorical</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
        <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;0.5&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Set3&#39;</span><span class="p">,</span> 
        <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">));</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Leave Majority&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Visiblemente, parece que el mapa representa un claro caso de autocorrelaci√≥n espacial positiva: en general, hay pocos casos visibles donde una observaci√≥n dada est√° rodeada por otras en la categor√≠a opuesta. Para explorar formalmente esta evaluaci√≥n inicial, podemos usar lo que se llama una estad√≠stica de ‚Äúconteo de uni√≥n‚Äù. Imagina un tablero de ajedrez con cuadrados verdes (G, valor 0) y amarillos (Y, valor 1). La idea de la estad√≠stica es contar las ocurrencias de uniones (o pares de vecinos) verdes-verdes (GG), amarillo-amarillo (YY), o verde-amarillo/amarillo-verde (GY) en el mapa. En este contexto, tanto GG como YY reflejan autocorrelaci√≥n espacial positiva, mientras que GY captura su contraparte negativa. La intuici√≥n de la estad√≠stica es proporcionar una l√≠nea de base de cu√°ntos GG, YY y GY se esperar√≠a bajo el caso de completa aleatoriedad espacial, y comparar esto con los recuentos observados en el conjunto de datos. Una situaci√≥n donde observamos m√°s GG/YY de lo esperado y menos GY de lo esperado sugerir√≠a autocorrelaci√≥n espacial positiva; mientras que lo opuesto, m√°s GY que GG/YY, apuntar√≠a hacia autocorrelaci√≥n espacial negativa.</p>
<p>Dado que los pesos espaciales solo se usan aqu√≠ para delimitar qui√©n es vecino o no, la estad√≠stica de conteo de uni√≥n requiere pesos binarios. As√≠ que transformemos w de vuelta a un estado no estandarizado:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w</span><span class="o">.</span><span class="n">transform</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="s1">&#39;O&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w</span><span class="o">.</span><span class="n">transform</span>
</pre></div>
</div>
</div>
</div>
<p>Podemos calcular la estad√≠stica como:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jc</span> <span class="o">=</span> <span class="n">esda</span><span class="o">.</span><span class="n">join_counts</span><span class="o">.</span><span class="n">Join_Counts</span><span class="p">(</span><span class="n">br</span><span class="p">[</span><span class="s1">&#39;Leave&#39;</span><span class="p">],</span> <span class="n">w</span><span class="p">)</span>
<span class="n">jc</span>
</pre></div>
</div>
</div>
</div>
<p>Como es com√∫n en todo PySAL, estamos creando un objeto (jc) que contiene mucha informaci√≥n m√°s all√° del valor de la estad√≠stica calculada. Por ejemplo, podemos verificar cu√°ntas ocurrencias de GG tenemos (nota el atributo es bb, que proviene de la referencia original donde las dos clases consideradas eran negras y blancas):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jc</span><span class="o">.</span><span class="n">bb</span>
</pre></div>
</div>
</div>
</div>
<p>¬øCu√°ntas ocurrencias de YY tiene nuestro mapa?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jc</span><span class="o">.</span><span class="n">ww</span>
</pre></div>
</div>
</div>
</div>
<p>¬øY cu√°ntas GY/YG encontramos?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jc</span><span class="o">.</span><span class="n">bw</span>
</pre></div>
</div>
</div>
</div>
<p>La suma de estos tres nos da el n√∫mero total de comparaciones:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jc</span><span class="o">.</span><span class="n">bb</span> <span class="o">+</span> <span class="n">jc</span><span class="o">.</span><span class="n">ww</span> <span class="o">+</span> <span class="n">jc</span><span class="o">.</span><span class="n">bw</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jc</span><span class="o">.</span><span class="n">J</span>
</pre></div>
</div>
</div>
</div>
<p>La estad√≠stica se basa en comparar el n√∫mero real de uniones de cada clase (bb, ww, bc) con lo que uno esperar√≠a en un caso de aleatoriedad espacial. Esas expectativas tambi√©n se pueden acceder, para el caso de GG/YY:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jc</span><span class="o">.</span><span class="n">mean_bb</span>
</pre></div>
</div>
</div>
</div>
<p>and for GY joins:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jc</span><span class="o">.</span><span class="n">mean_bw</span>
</pre></div>
</div>
</div>
</div>
<p>La inferencia estad√≠stica para obtener una idea de si estos valores probablemente provienen del azar o no se puede obtener como:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jc</span><span class="o">.</span><span class="n">p_sim_bb</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jc</span><span class="o">.</span><span class="n">p_sim_bw</span>
</pre></div>
</div>
</div>
</div>
<p>Estos resultados apuntan a una clara presencia de autocorrelaci√≥n espacial positiva, ya que hay muchas m√°s uniones de pares en la misma categor√≠a de las que se esperar√≠a (p_sim_bb) y significativamente menos uniones de categor√≠as opuestas (p_sim_bw).</p>
</section>
<section id="grafico-de-moran">
<h3>Gr√°fico de Moran<a class="headerlink" href="#grafico-de-moran" title="Permalink to this heading">#</a></h3>
<p>El gr√°fico de Moran es una forma de visualizar un conjunto de datos espaciales para explorar la naturaleza y la fuerza de la autocorrelaci√≥n espacial. Esencialmente, es un gr√°fico de dispersi√≥n tradicional en el que la variable de inter√©s se muestra contra su retraso espacial. Para poder interpretar los valores como por encima o por debajo de la media, y sus cantidades en t√©rminos de desviaciones est√°ndar, la variable de inter√©s suele estandarizarse restando su media y dividi√©ndola por su desviaci√≥n est√°ndar.</p>
<p>T√©cnicamente hablando, crear un Gr√°fico de Moran es muy similar a crear cualquier otro gr√°fico de dispersi√≥n en Python, siempre que hayamos estandarizado la variable y calculado su retraso espacial de antemano:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">br</span><span class="p">[</span><span class="s1">&#39;Pct_Leave_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span> <span class="n">br</span><span class="p">[</span><span class="s1">&#39;Pct_Leave&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">br</span><span class="p">[</span><span class="s1">&#39;Pct_Leave&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="p">)</span><span class="o">/</span> <span class="n">br</span><span class="p">[</span><span class="s1">&#39;Pct_Leave&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="n">br</span><span class="p">[</span><span class="s1">&#39;Pct_Leave_lag_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span> <span class="n">br</span><span class="p">[</span><span class="s1">&#39;w_Pct_Leave_std&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">br</span><span class="p">[</span><span class="s1">&#39;w_Pct_Leave_std&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="p">)</span><span class="o">/</span> <span class="n">br</span><span class="p">[</span><span class="s1">&#39;w_Pct_Leave_std&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Pct_Leave_std&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;w_Pct_Leave_std&#39;</span><span class="p">,</span><span class="n">ci</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">br</span><span class="p">,</span> <span class="n">line_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;r&#39;</span><span class="p">})</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Moran Plot - </span><span class="si">% Le</span><span class="s1">ave&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Otra forma de obtener esta gr√°fica es:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup the figure and axis</span>
<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="c1"># Plot values</span>
<span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Pct_Leave_std&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;w_Pct_Leave_std&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">br</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="c1"># Add vertical and horizontal lines</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="c1"># Display</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>La figura anterior muestra la relaci√≥n entre el porcentaje estandarizado que vot√≥ para salir de la UE (<code class="docutils literal notranslate"><span class="pre">Pct_Leave_std</span></code>) y su retraso espacial que, debido a que el <span class="math notranslate nohighlight">\(W\)</span> que se utiliz√≥ est√° estandarizado por filas, puede interpretarse como el porcentaje promedio que vot√≥ para salir en las √°reas circundantes de una Autoridad Local dada. Para guiar la interpretaci√≥n del gr√°fico, tambi√©n se incluye un ajuste lineal en la publicaci√≥n. Esta l√≠nea representa el mejor ajuste lineal al gr√°fico de dispersi√≥n o, en otras palabras, la mejor manera de representar la relaci√≥n entre las dos variables como una l√≠nea recta.</p>
<p>El gr√°fico muestra una relaci√≥n positiva entre ambas variables. Esto se asocia con la presencia de autocorrelaci√≥n espacial <em>positiva</em>: valores similares tienden a estar ubicados cerca uno del otro. Esto significa que la <em>tendencia general</em> es que los valores altos est√©n cerca de otros valores altos, y que los valores bajos est√©n rodeados de otros valores bajos. Sin embargo, esto no significa que esta sea la √∫nica situaci√≥n en el conjunto de datos: por supuesto, puede haber casos particulares donde los valores altos est√©n rodeados de valores bajos, y viceversa. Pero significa que, si tuvi√©ramos que resumir el patr√≥n principal de los datos en t√©rminos de cu√°n agrupados est√°n los valores similares, la mejor manera ser√≠a decir que est√°n positivamente correlacionados y, por lo tanto, agrupados en el espacio.</p>
<p>En el contexto del ejemplo, esto se puede interpretar en el sentido de que: las autoridades locales muestran autocorrelaci√≥n espacial positiva en la forma en que votaron en el refer√©ndum de la UE. Esto significa que las autoridades locales con un alto porcentaje de votantes a favor de salir tienden a estar ubicadas cerca de otras autoridades locales donde tambi√©n una parte significativa del electorado vot√≥ para salir, y viceversa.</p>
<p>El Gr√°fico de Moran es una excelente herramienta para explorar los datos y tener una buena idea de cu√°nto est√°n agrupados los valores en el espacio. Sin embargo, debido a que es un dispositivo gr√°fico, a veces es dif√≠cil condensar sus ideas en una forma m√°s concisa. Para estos casos, un buen enfoque es idear una medida estad√≠stica que resuma la figura. Esto es exactamente para lo que est√° destinado el √çndice de Moran.</p>
<p>De la misma manera que la media resume un elemento crucial de la distribuci√≥n de valores en un entorno no espacial, el √çndice de Moran hace lo mismo para un conjunto de datos espaciales. Continuando con la comparaci√≥n, podemos pensar en la media como un √∫nico valor num√©rico que resume un histograma o un gr√°fico de densidad de n√∫cleo. De manera similar, el √çndice de Moran captura gran parte de la esencia del Gr√°fico de Moran. De hecho, hay una conexi√≥n a√∫n m√°s cercana entre los dos: el valor del √çndice de Moran corresponde con la pendiente de la ajuste lineal superpuesto en el Gr√°fico de Moran.</p>
<p>Para calcular el √çndice de Moran en nuestro conjunto de datos, podemos llamar a una funci√≥n espec√≠fica en <code class="docutils literal notranslate"><span class="pre">PySAL</span></code> directamente:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mi</span> <span class="o">=</span> <span class="n">esda</span><span class="o">.</span><span class="n">Moran</span><span class="p">(</span><span class="n">br</span><span class="p">[</span><span class="s1">&#39;Pct_Leave&#39;</span><span class="p">],</span> <span class="n">w</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Ten en cuenta c√≥mo no necesitamos utilizar la versi√≥n estandarizada en este contexto, ya que no la representaremos visualmente.</p>
<p>El m√©todo <code class="docutils literal notranslate"><span class="pre">ps.Moran</span></code> crea un objeto que contiene mucha m√°s informaci√≥n que la estad√≠stica real. Si queremos recuperar el valor de la estad√≠stica, podemos hacerlo de esta manera:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mi</span><span class="o">.</span><span class="n">I</span>
</pre></div>
</div>
</div>
</div>
<p>La otra informaci√≥n que extraeremos del √çndice de Moran se relaciona con la inferencia estad√≠stica: ¬øqu√© tan probable es que el patr√≥n que observamos en el mapa y que captura en su valor el √çndice de Moran sea generado por un proceso completamente aleatorio? Si consider√°ramos la misma variable pero reorganiz√°ramos sus ubicaciones al azar, ¬øobtendr√≠amos un mapa con caracter√≠sticas similares?</p>
<p>Los detalles espec√≠ficos del mecanismo para calcular esto est√°n m√°s all√° del alcance de la sesi√≥n, pero es importante saber que un valor p lo suficientemente peque√±o asociado con el √çndice de Moran de un mapa permite rechazar la hip√≥tesis de que el mapa es aleatorio. En otras palabras, podemos concluir que el mapa muestra m√°s patr√≥n espacial de lo que esperar√≠amos si los valores se hubieran asignado aleatoriamente a una ubicaci√≥n particular.</p>
<p>El valor p m√°s confiable para el √çndice de Moran se puede encontrar en el atributo <code class="docutils literal notranslate"><span class="pre">p_sim</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mi</span><span class="o">.</span><span class="n">p_sim</span>
</pre></div>
</div>
</div>
</div>
<p>El valor se calcula como un valor p emp√≠rico que representa la proporci√≥n de realizaciones en la simulaci√≥n bajo aleatoriedad espacial que son m√°s extremas que el valor observado. Un valor p lo suficientemente peque√±o asociado con el √çndice de Moran de un mapa permite rechazar la hip√≥tesis de que el mapa es aleatorio. En otras palabras, podemos concluir que el mapa muestra m√°s patr√≥n espacial de lo que esperar√≠amos si los valores se hubieran asignado aleatoriamente a ubicaciones.</p>
<p>Ese es un valor muy bajo, especialmente considerando que en realidad es el valor m√≠nimo que podr√≠amos haber obtenido dado que la simulaci√≥n detr√°s de √©l utiliz√≥ 999 permutaciones (el valor predeterminado en PySAL) y, en t√©rminos est√°ndar, se considerar√≠a estad√≠sticamente significativo. Podemos elaborar un poco m√°s sobre la intuici√≥n detr√°s del valor de p_sim. Si generamos un gran n√∫mero de mapas con los mismos valores pero distribuidos aleatoriamente en el espacio, y calculamos la estad√≠stica del √çndice de Moran para cada uno de esos mapas, solo el 0.01% de ellos mostrar√≠a un valor absoluto m√°s grande que el que obtenemos a partir de los datos observados, y el otro 99.99% de los mapas aleatorios recibir√≠an un valor absoluto m√°s peque√±o del √çndice de Moran. Si recordamos nuevamente que el valor del √çndice de Moran tambi√©n se puede interpretar como la pendiente del Gr√°fico de Moran, lo que tenemos es que, en este caso, la disposici√≥n espacial particular de valores sobre el espacio que observamos para el porcentaje de votos a Favor de salir es m√°s concentrada que si mezcl√°ramos aleatoriamente las proporciones de votos en el mapa, de ah√≠ la significaci√≥n estad√≠stica. Como primer paso, el an√°lisis de autocorrelaci√≥n global puede ense√±arnos que las observaciones parecen estar positivamente autocorrelacionadas en el espacio. De hecho, el patr√≥n espacial general en la votaci√≥n del Refer√©ndum de la UE fue muy marcado: las √°reas cercanas tend√≠an a votar de manera similar.</p>
<p>Gracias al m√≥dulo de visualizaci√≥n splot en PySAL, podemos obtener una representaci√≥n r√°pida de la estad√≠stica que combina el Gr√°fico de Moran (derecha) con un gr√°fico de la prueba emp√≠rica que llevamos a cabo para obtener p_sim (izquierda):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pysal.viz</span> <span class="kn">import</span> <span class="n">splot</span>
<span class="kn">from</span> <span class="nn">splot.esda</span> <span class="kn">import</span> <span class="n">plot_moran</span>
<span class="n">plot_moran</span><span class="p">(</span><span class="n">mi</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>En el panel izquierdo podemos ver en gris la distribuci√≥n emp√≠rica generada al simular 999 mapas aleatorios con los valores de la variable Pct_Leave y luego calcular el √çndice de Moran para cada uno de esos mapas. La l√≠nea azul se√±ala la media. Por el contrario, la l√≠nea roja muestra el √çndice de Moran calculado para la variable utilizando la geograf√≠a observada en el conjunto de datos. Es claro que el valor bajo el patr√≥n observado es significativamente m√°s alto que bajo la aleatoriedad. Esta percepci√≥n se confirma en el panel derecho, donde se muestra un gr√°fico equivalente al Gr√°fico de Moran que creamos anteriormente.</p>
</section>
</section>
<section id="autocorrelacion-espacial-local">
<h2>Autocorrelaci√≥n espacial local<a class="headerlink" href="#autocorrelacion-espacial-local" title="Permalink to this heading">#</a></h2>
<p>En el cap√≠tulo anterior exploramos el uso de medidas globales de autocorrelaci√≥n espacial para plantear la pregunta de si la distribuci√≥n espacial general de nuestro atributo de inter√©s reflejaba un proceso geogr√°ficamente aleatorio o no. Estas estad√≠sticas son √∫tiles ya que la presencia de autocorrelaci√≥n espacial tiene importantes implicaciones para el an√°lisis estad√≠stico posterior. Desde una perspectiva sustantiva, la autocorrelaci√≥n espacial podr√≠a reflejar la operaci√≥n de procesos que generan asociaci√≥n entre los valores en ubicaciones cercanas. En estos casos, el modelado formal de las dimensiones espaciales de los procesos deber√≠a llevarse a cabo a continuaci√≥n. Por otro lado, la autocorrelaci√≥n espacial a veces puede surgir de operaciones de procesamiento de datos en las que los casos de dependencia son una forma de ruido no aleatorio en lugar de debido a procesos sustantivos. Independientemente de si la autocorrelaci√≥n espacial se debe a fuentes sustantivas o de molestias, es una forma de no aleatoriedad que complica el an√°lisis estad√≠stico.</p>
<p>Por estas razones, la capacidad de determinar si la autocorrelaci√≥n espacial est√° presente en un conjunto de datos georreferenciados es un componente cr√≠tico del conjunto de herramientas de ciencia de datos espaciales. Dicho esto, las medidas globales de autocorrelaci√≥n espacial son estad√≠sticas de ‚Äúmapa completo‚Äù, lo que significa que la √∫nica estad√≠stica se refiere al conjunto completo de datos. En otras palabras, las estad√≠sticas globales de autocorrelaci√≥n nos permiten detectar agrupaciones en un conjunto de datos georreferenciado. Por ejemplo, Moran‚Äôs I es una buena herramienta para resumir un conjunto de datos en un √∫nico valor que informa sobre su grado de agrupamiento geogr√°fico. Sin embargo, no es una medida adecuada para identificar √°reas dentro del mapa donde se encuentran tipos espec√≠ficos de valores (por ejemplo, altos, bajos). En otras palabras, Moran‚Äôs I nos puede decir que los valores est√°n agrupados en general, pero no nos informar√° sobre d√≥nde est√°n los grupos. Para ese prop√≥sito, necesitamos usar una medida local de autocorrelaci√≥n espacial. Las medidas locales consideran cada observaci√≥n individual y operan sobre ellas, en contraposici√≥n al conjunto de datos en su conjunto, como lo hacen las medidas globales. Debido a eso, no son buenas para resumir un mapa, pero permiten obtener m√°s informaci√≥n sobre subconjuntos geogr√°ficos interesantes de los datos. En este cap√≠tulo, consideramos los Indicadores Locales de Asociaci√≥n Espacial (LISAs), un contraparte local de medidas globales como Moran‚Äôs I. En el n√∫cleo de este m√©todo hay una clasificaci√≥n de las observaciones en un conjunto de datos en cuatro grupos derivados del Gr√°fico de Moran: valores altos rodeados de valores altos (HH), valores bajos cerca de otros valores bajos (LL), valores altos entre valores bajos (HL), y viceversa (LH). Cada uno de estos grupos se llama t√≠picamente ‚Äúcuadrantes‚Äù. Se puede ver una ilustraci√≥n de d√≥nde cae cada uno de estos grupos en el Gr√°fico de Moran a continuaci√≥n:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup the figure and axis</span>
<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="c1"># Plot values</span>
<span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Pct_Leave_std&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;w_Pct_Leave_std&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">br</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="c1"># Add vertical and horizontal lines</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">1.75</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s2">&quot;HH&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="s2">&quot;HL&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;LH&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="s2">&quot;LL&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
<span class="c1"># Display</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Hasta ahora hemos clasificado cada observaci√≥n en el conjunto de datos seg√∫n su valor y el de sus vecinos. Esto es solo la mitad del camino para identificar √°reas de concentraci√≥n inusual de valores. Para saber si cada una de las ubicaciones es un cluster <em>estad√≠sticamente significativo</em> de un tipo dado, nuevamente necesitamos compararlo con lo que esperar√≠amos si los datos se asignaran de manera completamente aleatoria. Despu√©s de todo, por definici√≥n, cada observaci√≥n ser√° de un tipo u otro, seg√∫n la comparaci√≥n anterior. Sin embargo, lo que nos interesa es si la fuerza con la que los valores est√°n concentrados es inusualmente alta.</p>
<p>Esto es exactamente para lo que est√°n dise√±ados los LISAs. Como antes, una descripci√≥n m√°s detallada de sus fundamentos estad√≠sticos est√° fuera del alcance en este contexto, pero trataremos de arrojar algo de luz sobre la intuici√≥n de c√≥mo lo hacen. La idea central es identificar casos en los que la comparaci√≥n entre el valor de una observaci√≥n y el promedio de sus vecinos sea m√°s similar (HH, LL) o m√°s diferente (HL, LH) de lo que esperar√≠amos por pura casualidad. El mecanismo para hacer esto es similar al del Moran‚Äôs I global, pero aplicado en este caso a cada observaci√≥n, lo que resulta en tantas estad√≠sticas como observaciones originales.</p>
<p>De esta forma la gr√°fica de Moran queda centrada en el plot, partiendo el espacio en cuadrantes que representan:</p>
<ul class="simple">
<li><p>High-High (HH): valores por encima de la media rodeado por valores por encima de la media.</p></li>
<li><p>Low-Low (LL): valores por debajo de la media rodeado por valores por debajo de la media.</p></li>
<li><p>High-Low (HL): valores por encima de la media rodeado por valores por debajo de la media.</p></li>
<li><p>Low-High (LH): valores por debajo de la media rodeado por valores por encima de la media.</p></li>
</ul>
<p>Los LISAs se utilizan ampliamente en muchos campos para identificar clusters de valores en el espacio. Son una herramienta muy √∫til que puede devolver r√°pidamente √°reas en las que los valores est√°n concentrados y proporcionar evidencia <em>sugerente</em> sobre los procesos que podr√≠an estar en juego. Por eso, tienen un lugar privilegiado en la caja de herramientas exploratoria. Ejemplos de contextos donde los LISAs pueden ser √∫tiles incluyen: identificaci√≥n de clusters espaciales de pobreza en regiones, detecci√≥n de enclaves √©tnicos, delimitaci√≥n de √°reas de actividad particularmente alta/baja de cualquier fen√≥meno, etc.</p>
<p>En Python, podemos calcular LISAs de una manera muy simplificada gracias a <code class="docutils literal notranslate"><span class="pre">PySAL</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lisa</span> <span class="o">=</span> <span class="n">esda</span><span class="o">.</span><span class="n">Moran_Local</span><span class="p">(</span><span class="n">br</span><span class="p">[</span><span class="s1">&#39;Pct_Leave&#39;</span><span class="p">],</span> <span class="n">w</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Esto revela una distribuci√≥n bastante sesgada debido al predominio de las formas positivas de asociaci√≥n espacial. Aqu√≠ es importante tener en cuenta que los valores positivos altos surgen de la similitud de valores en el espacio, y esto puede deberse a que los valores altos est√°n al lado de valores altos o a que los valores bajos est√°n al lado de valores bajos. Los valores locales Ii en s√≠ mismos no pueden distinguir entre estos dos casos.</p>
<p>Los valores en la cola izquierda de la densidad representan ubicaciones que muestran asociaci√≥n espacial negativa. Tambi√©n hay dos formas, un valor alto rodeado de valores bajos, o un valor bajo rodeado de observaciones vecinas de alto valor. Y, nuevamente, el valor Ii no puede distinguir entre los dos casos.</p>
<p>Debido a su propia naturaleza, mirar el resultado num√©rico de los LISAs no siempre es la forma m√°s √∫til de aprovechar toda la informaci√≥n que pueden proporcionar. Recuerda que estamos calculando una estad√≠stica para cada observaci√≥n en los datos, por lo que, si tenemos muchas de ellas, ser√° dif√≠cil extraer alg√∫n patr√≥n significativo. En este contexto, un mapa de coropletas puede ayudar. A primera vista, esto puede parecer sugerir que un mapa de los valores Ii ser√≠a una forma √∫til de visualizar la distribuci√≥n espacial:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
<span class="n">br</span><span class="p">[</span><span class="s1">&#39;Is&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lisa</span><span class="o">.</span><span class="n">Is</span>
<span class="n">br</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;Is&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">scheme</span><span class="o">=</span><span class="s1">&#39;quantiles&#39;</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">);</span>
<span class="n">ctx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">crs</span><span class="o">=</span><span class="n">br</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="n">ctx</span><span class="o">.</span><span class="n">providers</span><span class="o">.</span><span class="n">Stamen</span><span class="o">.</span><span class="n">TerrainBackground</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Sin embargo, esto no nos informa de ninguna manera sobre qu√© tipo de correlaci√≥n espacial est√° experimentando cada √°rea. Por ejemplo, ¬øson similares las √°reas amarillas en Escocia a las del cl√∫ster oriental de valores altos tambi√©n? Adem√°s, sabemos que los valores alrededor de cero no ser√°n estad√≠sticamente significativos. ¬øCu√°les son, por lo tanto, significativos y no significativos desde un punto de vista estad√≠stico? En otras palabras, ¬øcu√°les pueden considerarse cl√∫steres estad√≠sticos y cu√°les ruido? Para responder a estas preguntas, necesitamos traer informaci√≥n adicional que hemos obtenido al calcular las estad√≠sticas LISA. Primero construyamos una figura de cuatro parcelas que re√∫na todas estas perspectivas diferentes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">ListedColormap</span>
<span class="c1"># Set up figure and axes</span>
<span class="n">f</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="c1"># Make the axes accessible with single indexing</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

                    <span class="c1"># Subplot 1 #</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">br</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;Is&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">scheme</span><span class="o">=</span><span class="s1">&#39;quantiles&#39;</span><span class="p">,</span>
        <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>

                    <span class="c1"># Subplot 2 #</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">q_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Q1&#39;</span><span class="p">,</span> <span class="s1">&#39;Q2&#39;</span><span class="p">,</span> <span class="s1">&#39;Q3&#39;</span><span class="p">,</span> <span class="s1">&#39;Q4&#39;</span><span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">q_labels</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">lisa</span><span class="o">.</span><span class="n">q</span><span class="p">]</span>
<span class="n">hmap</span> <span class="o">=</span> <span class="n">ListedColormap</span><span class="p">([</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;lightblue&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;pink&#39;</span><span class="p">])</span>
<span class="n">br</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">cl</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;cl&#39;</span><span class="p">,</span> <span class="n">categorical</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> \
        <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">hmap</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> \
        <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>

                    <span class="c1"># Subplot 3 #</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">sig</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">lisa</span><span class="o">.</span><span class="n">p_sim</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">)</span>
<span class="n">hmap</span> <span class="o">=</span> <span class="n">ListedColormap</span><span class="p">([</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span><span class="s1">&#39;black&#39;</span><span class="p">])</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;non-sig.&#39;</span><span class="p">,</span> <span class="s1">&#39;significant&#39;</span><span class="p">]</span> 
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sig</span><span class="p">]</span>
<span class="n">br</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">cl</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;cl&#39;</span><span class="p">,</span> <span class="n">categorical</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> \
        <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">hmap</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> \
        <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
                            
                    <span class="c1"># Subplot 4 #</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="n">hotspot</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">sig</span> <span class="o">*</span> <span class="n">lisa</span><span class="o">.</span><span class="n">q</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span>
<span class="n">coldspot</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">sig</span> <span class="o">*</span> <span class="n">lisa</span><span class="o">.</span><span class="n">q</span><span class="o">==</span><span class="mi">3</span><span class="p">)</span>
<span class="n">doughnut</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">sig</span> <span class="o">*</span> <span class="n">lisa</span><span class="o">.</span><span class="n">q</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span>
<span class="n">diamond</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">sig</span> <span class="o">*</span> <span class="n">lisa</span><span class="o">.</span><span class="n">q</span><span class="o">==</span><span class="mi">4</span><span class="p">)</span>
<span class="n">spots</span> <span class="o">=</span> <span class="n">hotspot</span> <span class="o">+</span> <span class="n">coldspot</span> <span class="o">+</span> <span class="n">doughnut</span> <span class="o">+</span> <span class="n">diamond</span>
<span class="n">spot_labels</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;0 ns&#39;</span><span class="p">,</span> <span class="s1">&#39;1 hot spot&#39;</span><span class="p">,</span> <span class="s1">&#39;2 doughnut&#39;</span><span class="p">,</span> <span class="s1">&#39;3 cold spot&#39;</span><span class="p">,</span> <span class="s1">&#39;4 diamond&#39;</span><span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">spot_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">spots</span><span class="p">]</span>
<span class="n">hmap</span> <span class="o">=</span> <span class="n">ListedColormap</span><span class="p">([</span> <span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;lightblue&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;pink&#39;</span><span class="p">])</span>


<span class="n">br</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">cl</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;cl&#39;</span><span class="p">,</span> <span class="n">categorical</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> \
        <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">hmap</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> \
        <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>


<span class="c1"># Display the figure</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>La figura en la parte superior izquierda replica nuestro primer mapa anterior. Las ubicaciones verdes y amarillas tienen los valores m√°s grandes para las estad√≠sticas locales, sin embargo, esto no distingue entre asociaci√≥n positiva de bajo apoyo para el voto Brexit y asociaci√≥n positiva de alto apoyo para el Brexit.</p>
<p>Para distinguir entre estos dos casos, el mapa en la parte superior derecha muestra la ubicaci√≥n de la estad√≠stica LISA en el cuadrante del gr√°fico de dispersi√≥n de Moran, que se registra en el atributo q:</p>
<p>Todo lo que necesitamos pasar es la variable de inter√©s, el porcentaje de votos para salir, y los pesos espaciales que describen las relaciones de vecindad entre las diferentes observaciones que componen el conjunto de datos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Break observations into significant or not</span>
<span class="n">br</span><span class="p">[</span><span class="s1">&#39;significant&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lisa</span><span class="o">.</span><span class="n">p_sim</span> <span class="o">&lt;</span> <span class="mf">0.05</span>
<span class="c1"># Store the quadrant they belong to</span>
<span class="n">br</span><span class="p">[</span><span class="s1">&#39;quadrant&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lisa</span><span class="o">.</span><span class="n">q</span>
</pre></div>
</div>
</div>
</div>
<p>Deteng√°monos un momento en estos dos pasos. Primero, la columna <code class="docutils literal notranslate"><span class="pre">significant</span></code>. De manera similar al Moran‚Äôs I global, <code class="docutils literal notranslate"><span class="pre">PySAL</span></code> est√° calculando autom√°ticamente un valor p para cada LISA. Dado que no todas las observaciones representan una situaci√≥n estad√≠sticamente significativa, queremos identificar aquellas con un valor p lo suficientemente peque√±o como para descartar la posibilidad de obtener una situaci√≥n similar por pura casualidad. Siguiendo un razonamiento similar al del Moran‚Äôs I global, seleccionamos el 5% como el umbral para la significancia estad√≠stica. Para identificar estos valores, creamos una variable, <code class="docutils literal notranslate"><span class="pre">significant</span></code>, que contiene <code class="docutils literal notranslate"><span class="pre">True</span></code> si el valor p de la observaci√≥n satisface la condici√≥n, y <code class="docutils literal notranslate"><span class="pre">False</span></code> en caso contrario. Podemos verificar si esto es as√≠:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">br</span><span class="p">[</span><span class="s1">&#39;significant&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Nota c√≥mo el tercero y el cuarto son menores que 0.05, como la variable <code class="docutils literal notranslate"><span class="pre">significant</span></code> identific√≥ correctamente.</p>
<p>En segundo lugar, el cuadrante al que pertenece cada observaci√≥n. Este es m√°s f√°cil ya que viene incorporado directamente en el objeto <code class="docutils literal notranslate"><span class="pre">lisa</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">br</span><span class="p">[</span><span class="s1">&#39;quadrant&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>La correspondencia entre los n√∫meros en la variable y los cuadrantes reales es la siguiente:</p>
<ul class="simple">
<li><p>1: HH</p></li>
<li><p>2: LH</p></li>
<li><p>3: LL</p></li>
<li><p>4: HL</p></li>
</ul>
<p>Con estos dos elementos, <code class="docutils literal notranslate"><span class="pre">significant</span></code> y <code class="docutils literal notranslate"><span class="pre">quadrant</span></code>, podemos construir un mapa t√≠pico de cl√∫ster LISA, combinando las habilidades de mapeo con lo que hemos aprendido sobre c√≥mo hacer subconjuntos y consultas en tablas:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">splot.esda</span> <span class="kn">import</span> <span class="n">lisa_cluster</span>
<span class="n">lisa_cluster</span><span class="p">(</span><span class="n">lisa</span><span class="p">,</span> <span class="n">br</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>El mapa anterior muestra los resultados de LISA del voto del Brexit. En rojo brillante, encontramos aquellas autoridades locales con una concentraci√≥n inusual de votantes partidarios de dejar la UE, rodeados tambi√©n por niveles altos de voto a favor de dejar. Esto corresponde con √°reas en el este de Inglaterra, el Black Country y el este de Londres. En rojo claro, encontramos el primer tipo de <em>valores at√≠picos espaciales</em>. Estas son √°reas con un alto voto a favor de dejar, pero rodeadas de √°reas con poco apoyo para dejar la UE (por ejemplo, el centro de Londres). Finalmente, en azul claro encontramos el otro tipo de valor at√≠pico espacial: autoridades locales con bajo apoyo para dejar, rodeadas de otras autoridades con alto apoyo.</p>
<p>La interpretaci√≥n sustantiva de un mapa LISA debe relacionar su resultado con la intenci√≥n original del analista que cre√≥ el mapa. En este caso, nuestra idea original era explorar la estructura espacial del apoyo para salir de la UE. El LISA resulta ser una herramienta bastante √∫til en este contexto. Comparando el mapa LISA anterior con el coropl√©tico con el que comenzamos, podemos interpretar el LISA como una ‚Äúsimplificaci√≥n‚Äù de la imagen detallada pero quiz√°s demasiado complicada en el coropl√©tico que enfoca la atenci√≥n del lector en las √°reas que muestran una concentraci√≥n particularmente alta de valores (dis)similares, ayudando a que la estructura espacial del voto emerja de manera m√°s expl√≠cita. El resultado de esto destaca la relevancia que tuvieron el este de Inglaterra y las Midlands en la votaci√≥n para salir, as√≠ como las regiones del mapa donde hubo mucho menos entusiasmo por salir.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_local_autocorrelation</span><span class="p">(</span><span class="n">lisa</span><span class="p">,</span> <span class="n">br</span><span class="p">,</span> <span class="s1">&#39;Pct_Leave&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="06_ArealData.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">An√°lisis de datos areales: mapas</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#matriz-de-pesos-basada-en-contiguidad">Matriz de pesos basada en contiguidad</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#matriz-de-pesos-basada-en-distancias">Matriz de pesos basada en distancias</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#spatial-lag">Spatial lag</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#autocorrelacion-espacial-global">Autocorrelaci√≥n espacial global</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#caso-binario-conteos-de-union">Caso binario: conteos de uni√≥n</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#grafico-de-moran">Gr√°fico de Moran</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#autocorrelacion-espacial-local">Autocorrelaci√≥n espacial local</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Edier V. Aristiz√°bal G.
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      ¬© Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>